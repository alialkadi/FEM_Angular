<div class="update-service-container">
    <form [formGroup]="serviceForm" (ngSubmit)="onSubmit()">
        <!-- ================= HIERARCHY ================= -->
        <div class="service-card">
            <h3>Service Hierarchy</h3>
            <p class="hint">Read-only – reflects backend assignment</p>
            <div class="form-group">
                <label>Category</label>
                <select formControlName="categoryId" [disabled]="true">
                    <option *ngFor="let c of categories" [value]="c.id">{{ c.name }}</option>
                </select>
            </div>
            <div class="form-group" *ngIf="categoryTypes.length">
                <label>Category Type</label>
                <select formControlName="categoryTypeId" [disabled]="true">
                    <option *ngFor="let t of categoryTypes" [value]="t.id">{{ t.name }}</option>
                </select>
            </div>
            <div class="form-group" *ngIf="structures.length">
                <label>Structure</label>
                <select formControlName="structureId" [disabled]="true">
                    <option *ngFor="let s of structures" [value]="s.id">{{ s.name }}</option>
                </select>
            </div>
            <div class="form-group" *ngIf="parts.length">
                <label>Part</label>
                <select formControlName="partId" [disabled]="true">
                    <option *ngFor="let p of parts" [value]="p.id">{{ p.name }}</option>
                </select>
            </div>
            <div class="form-group" *ngIf="partOptions.length">
                <label>Part Option</label>
                <select formControlName="partOptionId" [disabled]="true">
                    <option *ngFor="let o of partOptions" [value]="o.id">{{ o.name }}</option>
                </select>
            </div>
        </div>
        <!-- ================= SERVICE DATA ================= -->
        <div class="service-card">
            <h3>Service Data</h3>
            <div class="form-group">
                <label>Service Name</label>
                <input type="text" formControlName="name" />
            </div>
            <div class="form-group">
                <label>Description</label>
                <textarea formControlName="description"></textarea>
            </div>
            <div class="inline-fields">
                <input type="number" placeholder="Base Cost" formControlName="baseCost" />
                <input type="number" placeholder="Labors" formControlName="labors" />
                <input type="number" placeholder="Delivery Days" formControlName="deliveryDays" />
            </div>
            <div class="inline-fields">
                <input type="number" placeholder="Warranty Duration" formControlName="warrantyDuration" />
                <select formControlName="warrantyUnit">
                    <option value="Days">Days</option>
                    <option value="Weeks">Weeks</option>
                    <option value="Months">Months</option>
                </select>
            </div>
            <div class="form-group">
                <label>Replace Image</label>
                <input type="file" (change)="onFileSelected($event)" />
                <img *ngIf="previewUrl" [src]="previewUrl" class="preview-img" />
            </div>
        </div>
        <!-- ================= METADATA ================= -->
        <div class="service-card metadata-card">
            <div class="metadata-header" (click)="toggleMetadata()">
                <h3>Metadata Attributes</h3>
                <span>{{ showMetadata ? '▼' : '▶' }}</span>
            </div>
            <div *ngIf="showMetadata">
                <app-attribute-assignment [targetType]="metadataTargetType" [targetId]="metadataTargetId"
                    (metadataChange)="onMetadataChange($event)">
                </app-attribute-assignment>
            </div>
        </div>
        <!-- ================= ACTIONS ================= -->
        <div class="actions">
            <button type="submit" [disabled]="isSubmitting"> {{ isSubmitting ? 'Updating…' : 'Update Service' }}
            </button>
        </div>
    </form>
</div>